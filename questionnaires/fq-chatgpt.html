<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-widthinitial-scale=1.0">
    <title>Friendship Questionnaire (inspired by)</title>
    <script src="dist/jspsych.js"></script>
    <script src="dist/plugin-survey-multi-choice.js"></script>
    <script src="dist/plugin-html-button-response.js"></script>
    <script src="dist/plugin-html-keyboard-response.js"></script>
    <link rel="stylesheet" href="dist/jspsych.css">
    <style>
        #jspsych-target { 
            border: 1px solid rgb(133, 133, 133); 
            border-radius: 5px;
            padding:20px;
        }
        body { padding: 50px;}
    </style>
</head>
<body>
    <div id="jspsych-target" class="flex one">
        <button id="start-button" style="font-size: 24px; padding: 15px; margin-top: 50px;">Start Questionnaire</button>
    </div>
    
    <script>
        document.getElementById('start-button').addEventListener('click', function() {
            document.getElementById('start-button').style.display = 'none';
            
            var jsPsychLocal = initJsPsych({
                display_element: 'jspsych-target',
                show_progress_bar: true,
                on_finish: function() {
                    jsPsychLocal.data.displayData();
                }
            });
            
            var trialMulti = {
                type: jsPsychSurveyMultiChoice,
                questions: [
                    {
                        prompt: "I have:", 
                        name: "q1", 
                        options: [
                            "One or two particular best friends.", 
                            "Several friends who I call best friends.",
                            "Nobody I would call a best friend."
                        ], 
                        required: true
                    }, 
                    {
                        prompt: "The most important thing about a friendship is:", 
                        name: "q2", 
                        options: [
                            "Having somebody to confide in.",
                            "Having somebody to have fun with."
                        ], 
                        required: false
                    }
                ],
            };
            
            var scale = ["Strongly Disagree", "Disagree", "Neutral", "Agree", "Strongly Agree"];
            
            var trials = multiQuestions.map((q, index) => {
                return {
                    type: jsPsychHtmlButtonResponse,
                    stimulus: `<p style='font-size: 28px;'>${index+1}.&nbsp;${q}</p>` ,
                    choices: scale,
                    data: { question: q },
                }
            });

            var trialMulti = {
                type: jsPsychSurveyMultiChoice,
                questions: [
                    {
                        prompt: "I have:", 
                        name: "q1", 
                        options: [
                            "One or two particular best friends.", 
                            "Several friends who I call best friends.",
                            "Nobody I would call a best friend."
                        ], 
                        required: true
                    }, 
                    {
                        prompt: "The most important thing about a friendship is:", 
                        name: "q2", 
                        options: [
                            "Having somebody to confide in.",
                            "Having somebody to have fun with."
                        ], 
                        required: false
                    }
                ],
            };
            
            var score_trial = {
                type: jsPsychHtmlKeyboardResponse,
                stimulus: function() {
                    var responses = jsPsychLocal.data.get().values().map(d => d.response);
                    console.log(jsPsychLocal.data.get());
                    var scoring = { 0: 1, 1: 2, 2: 3, 3: 4, 4: 5 };
                    var totalScore = responses.reduce((sum, resp) => sum + scoring[resp], 0);
                    return `<p style='font-size: 28px;'>Your Friendship Score: <strong>${totalScore}</strong></p>`;
                },
                choices: "NO_KEYS",
                trial_duration: 5000
            };
            
            jsPsychLocal.run([trialMulti,...trials, score_trial]);
        });
    </script>
</body>
</html>
