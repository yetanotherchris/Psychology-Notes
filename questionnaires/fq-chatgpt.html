<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-widthinitial-scale=1.0">
    <title>Friendship Questionnaire (inspired by)</title>
    <script src="dist/jspsych.js"></script>
    <script src="dist/plugin-survey-multi-choice.js"></script>
    <script src="dist/plugin-html-button-response.js"></script>
    <script src="dist/plugin-html-keyboard-response.js"></script>
    <script src="dist/plugin-survey.js"></script>
    <link rel="stylesheet" href="dist/jspsych.css">
    <link rel="stylesheet" href="dist/survey.css">
    <style>
        #jspsych-target { 
            border: 1px solid rgb(133, 133, 133); 
            border-radius: 5px;
            padding:20px;
        }
        body { padding: 50px;}
    </style>
</head>
<body>
    <div id="jspsych-target" class="flex one">
        <button id="start-button" style="font-size: 24px; padding: 15px; margin-top: 50px;">Start Questionnaire</button>
    </div>

    <script>
        var questions = [];
        /*fetch('./fq-questions-1.json')
        .then(response => {
            if (!response.ok) {
                throw new Error('Network response was not ok');
            }
            return response.json();
        })
        .then(data => {
            questions = data;
        })
        .catch(error => console.error('Error loading JSON:', error));*/

        document.getElementById('start-button').addEventListener('click', function() {
            document.getElementById('start-button').style.display = 'none';
            
            var jsPsychLocal = initJsPsych({
                display_element: 'jspsych-target',
                show_progress_bar: true,
                on_finish: function() {
                    jsPsychLocal.data.displayData();
                }
            });
            
            var trialMulti = {
                type: jsPsychSurveyMultiChoice,
                questions: [
                    {
                        prompt: "I have:", 
                        name: "q1", 
                        options: [
                            "One or two particular best friends.", 
                            "Several friends who I call best friends.",
                            "Nobody I would call a best friend."
                        ], 
                        required: true
                    }, 
                    {
                        prompt: "The most important thing about a friendship is:", 
                        name: "q2", 
                        options: [
                            "Having somebody to confide in.",
                            "Having somebody to have fun with."
                        ], 
                        required: false
                    }
                ],
            };
            
            var scale = ["Strongly Disagree", "Disagree", "Neutral", "Agree", "Strongly Agree"];
            
            var trials = questions.map((q, index) => {
                return {
                    type: jsPsychHtmlButtonResponse,
                    stimulus: `<p style='font-size: 28px;'>${index+1}.&nbsp;${q}</p>` ,
                    choices: scale,
                    data: { question: q },
                }
            });
            
            var score_trial = {
                type: jsPsychHtmlKeyboardResponse,
                stimulus: function() {
                    var responses = jsPsychLocal.data.get().values().map(d => d.response);
                    console.log(jsPsychLocal.data.get());
                    var scoring = { 0: 1, 1: 2, 2: 3, 3: 4, 4: 5 };
                    var totalScore = responses.reduce((sum, resp) => sum + scoring[resp], 0);
                    return `<p style='font-size: 28px;'>Your Friendship Score: <strong>${totalScore}</strong></p>`;
                },
                choices: "NO_KEYS",
                trial_duration: 5000
            };

            ///
            const surveyTrial = {
                type: jsPsychSurvey,
                survey_json: {
                    showQuestionNumbers: false,
                    title: 'Likert scale examples',
                    pages: [
                    {
                        elements: [
                        {
                            type: "ranking",
                            name: "smartphone-features",
                            title: "Please rank the following smartphone features from the most important to the least",
                            isRequired: true,
                            choices: [
                                "Long battery life",
                                "Plenty of storage capacity",
                                "High-quality camera",
                                "Powerful CPU",
                                "Large screen size",
                                "High durability",
                                "Low price"
                            ]
                        }, 
                        {
                            type: 'rating',
                            name: 'like-cake',
                            title: 'I like to eat cake.',
                            description: 'Star rating scale with min/max descriptions',
                            minRateDescription: 'Strongly Disagree',
                            maxRateDescription: 'Strongly Agree',
                            rateType: 'stars',
                            rateCount: 10,
                            rateMax: 10,
                        },
                        {
                            type: 'rating',
                            name: 'like-cooking',
                            title: 'How much do you enjoy cooking?',
                            description: 'Smiley rating scale without min/max descriptions',
                            rateType: 'smileys',
                            rateCount: 10,
                            rateMax: 10,
                            scaleColorMode: 'colored',
                        }
                        ]
                    }, {
                        elements: [
                        {
                            type: 'matrix',
                            name: 'like-food-matrix',
                            title: 'Matrix question for rating mutliple statements on the same scale.',
                            alternateRows: true,
                            isAllRowRequired: true,
                            rows: [
                            {text: 'I like to eat vegetables.', value: 'VeggiesTable'},
                            {text: 'I like to eat fruit.', value: 'FruitTable'},
                            {text: 'I like to eat cake.', value: 'CakeTable'},
                            {text: 'I like to cook.', value: 'CookTable'},
                            ],
                            columns: [{
                            "value": 5,
                            "text": "Strongly agree"
                            }, {
                            "value": 4,
                            "text": "Agree"
                            }, {
                            "value": 3,
                            "text": "Neutral"
                            }, {
                            "value": 2,
                            "text": "Disagree"
                            }, {
                            "value": 1,
                            "text": "Strongly disagree"
                            }]
                        }
                        ]
                    }
                    ]
                }
                };
            ///
            
            jsPsychLocal.run([surveyTrial,trialMulti,...trials, score_trial]);
        });
    </script>
</body>
</html>
